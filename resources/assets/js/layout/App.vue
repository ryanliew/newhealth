<template>
	<div>
		<loader v-if="isLoading"></loader>
		<header class="site-header">
		    <div class="container-fluid">
		        <a href="http://newhealth2u.com" class="site-logo">
		            <img class="hidden-md-down" src="/img/fav180x180.png" alt="">
		            <img class="hidden-lg-down" src="/img/fav180x180.png" alt="">
		        </a>
		
		        <button id="show-hide-sidebar-toggle" class="show-hide-sidebar">
		            <span>toggle menu</span>
		        </button>
		
		        <button class="hamburger hamburger--htla">
		            <span>toggle menu</span>
		        </button>
		        <div class="site-header-content">
		            <div class="site-header-content-in">
		                <div class="site-header-shown">
		                    
		                    <language-switcher></language-switcher>
		
		                    <div class="dropdown user-menu">
		                        <button class="dropdown-toggle" id="dd-user-menu" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		                            <img src="img/avatar-2-64.png" alt="">
		                            <span class="pl-1 pr-1">{{ user.name }}</span>
		                        </button>
		                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dd-user-menu">
		                        	<router-link to="profile" class="dropdown-item">
										<span class="font-icon glyphicon glyphicon-user"></span>
							            {{ 'nav.profile' | trans }}
							        </router-link><!-- 
		                            <a class="dropdown-item" href="#"><span class="font-icon glyphicon glyphicon-user"></span>{{ 'nav.profile' | trans }}</a> -->
		                            <!-- <a class="dropdown-item" href="#"><span class="font-icon glyphicon glyphicon-cog"></span>{{ 'nav.settings' | trans }}</a> -->
		                            <div class="dropdown-divider"></div>
		                            <a @click="logout" class="dropdown-item"><span class="font-icon glyphicon glyphicon-log-out"></span>{{ 'nav.logout' | trans }}</a>
		                        </div>
		                    </div>
		                </div><!--.site-header-shown-->
		
		                <div class="mobile-menu-right-overlay"></div>
		            </div><!--site-header-content-in-->
		        </div><!--.site-header-content-->
		    </div><!--.container-fluid-->
		</header><!--.site-header-->
		
		<side-nav></side-nav>
		

		<div class="page-content" id="body-content">
			<div class="container-fluid">
				<router-view></router-view>
				<flash></flash>
			</div><!--.container-fluid-->
		</div><!--.page-content-->

		
	</div>	
</template>

<script>
	import LanguageSwitcher from "../components/LanguageSwitcher.vue";
	export default {
		props: [''],
		data() {
			return {
				isLoading: false,
				user: window.user
			};
		},

		components: { LanguageSwitcher },

		mounted() {
			window.events.$on('authenticate', data => { this.user = data; });
		},

		methods: {
			logout() {
				this.isLoading = true;
				axios.post('/logout')
					.then(response => this.onLogoutSuccess(response))
					.catch(response => this.onLogoutError(response));
			},

			onLogoutSuccess(response) {
				user = '';
				window.location.href = "/register";
			},

			onLogoutError(response) {
				user = '';
				window.location.href = "/register";
			}
		}	
	}
</script>